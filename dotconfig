#!/bin/bash

set -e

DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

usage() {
    echo "Usage: $0 <pull | push> <PROGRAM | all>"
    echo
    echo "  PROGRAM:"
    echo "      bash"
    echo "      git"
    echo "      terminator"
    echo "      tint2"
    echo "      vscode"
    echo "      xmonad"
    echo "      xresources"
    echo
}

config_bash() {
    mkdir -p "$DIR/bash"
    copy "$HOME/.bashrc"  "$DIR/bash/bashrc"
    copy "$HOME/.profile" "$DIR/bash/profile"
}

config_compton() {
    mkdir -p "$DIR/compton"
    copy "$HOME/.config/compton.conf" "$DIR/compton/compton.conf"
}

config_git() {
    mkdir -p "$DIR/git"
    copy "$HOME/.gitconfig" "$DIR/git/config"
    sed '/token = /d' -i "$DIR/git/config"
}

config_terminator() {
    copy "$HOME/.config/terminator" "$DIR/terminator"
}

config_tint2() {
    mkdir -p "$HOME/.config/tint2" "$DIR/tint2"
    copy "$HOME/.config/tint2/tint2rc" "$DIR/tint2/tint2rc"
}

config_vscode() {
    mkdir -p "$HOME/.config/Code" "$DIR/vscode"
    copy "$HOME/.config/Code/User/settings.json"    "$DIR/vscode/settings.json"
    copy "$HOME/.config/Code/User/keybindings.json" "$DIR/vscode/keybindings.json"
}

config_xmonad() {
    mkdir -p "$HOME/.xmonad" "$DIR/xmonad"
    copy "$HOME/.xmonad/xmonad.hs"         "$DIR/xmonad/xmonad.hs"
    copy "$HOME/.xmonad/xmonad-session-rc" "$DIR/xmonad/xmonad-session-rc"
}

config_xresources() {
    mkdir -p "$DIR/Xresources"
    copy "$HOME/.Xresources" "$DIR/Xresources/Xresources"
}

config_all() {
    config_bash "$1"
    config_compton "$1"
    config_git "$1"
    config_terminator "$1"
    config_tint2 "$1"
    config_vscode "$1"
    config_xmonad "$1"
    config_xresources "$1"
}

if [[ $# -ne 2 || ( "$1" != "pull" && "$1" != "push" ) ]]; then
    usage
    exit 1
else
    if [[ "$1" == "pull" ]]; then
        copy() {
            cp -r -T "$1" "$2"
        }
    else
        copy() {
            cp -i -r -T "$2" "$1"
        }
    fi
fi

"config_$2" "$1"
